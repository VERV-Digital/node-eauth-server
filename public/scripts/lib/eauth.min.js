!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Eauth={})}(this,(function(t){"use strict";t.default=function(){function t(t){this.OAUTH_CLIENT_ID=t.OAUTH_CLIENT_ID,this.OAUTH_URL=t.OAUTH_URL,this.OAUTH_REDIRECT_URI=t.OAUTH_REDIRECT_URI,this.OAUTH_STATE=t.OAUTH_STATE,this.ENS_ROUTE=t.ENS_ROUTE,this.AUTH_ROUTE=t.AUTH_ROUTE,this.CONTRACT_AUTH_ROUTE=t.CONTRACT_AUTH_ROUTE,this.REDIRECT_URI=t.REDIRECT_URI,this.AUTH_RESPONSE=null,this.PREFIX=t.PREFIX?t.PREFIX:""}var e=t.prototype;return e.submitENS=function(t){if(!/.*\.eth$/.test(t))throw Error("ENS names should end with '.eth'.");return fetch(this.ENS_ROUTE+"/"+t,{method:"post"}).then((function(t){return t.json()})).then((function(t){if(!t.success)throw Error(t.message);return t}))},e.oauthLogin=function(){window.location.href=this.OAUTH_URL+"?client_id="+this.OAUTH_CLIENT_ID+"&redirect_uri="+this.OAUTH_REDIRECT_URI+"&response_type=code&state="+this.OAUTH_STATE},e.ethLogin=function(t,e){var n=this;void 0===e&&(e=function(){window.location.reload()}),t.enable().then((function(i){n.authStart(t,i[0],e)}))},e.authStart=function(t,e,n){var i=this;return/^(0x)?[0-9a-f]{40}$/i.test(e)?fetch(this.AUTH_ROUTE+"/"+e,{headers:{chainid:parseInt(t.chainId)+""},method:"get"}).then((function(t){return t.text()})).then((function(r){var a=JSON.parse(r),s=null==a?void 0:a.message,o=s.banner,h=s.token,u={types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Eauth:[{name:"banner",type:"string"},{name:"message",type:"string"},{name:"token",type:"string"}]},primaryType:"Eauth",domain:{name:"Eauth",version:"1",chainId:parseInt(t.chainId),verifyingContract:"0x0000000000000000000000000000000000000000"},message:{banner:o,message:i.PREFIX,token:h}},R=[e,JSON.stringify(u)];t.sendAsync({id:1,method:"eth_signTypedData_v4",params:R},(function(e,r){if(e||r.error)return i.ERROR=e||r.error,n();var a=r.result;return null!==h&&null!==a?fetch(i.AUTH_ROUTE+"/"+h+"/"+a,{headers:{chainid:parseInt(t.chainId)+""},method:"post"}).then((function(t){return t.text()})).then((function(t){i.AUTH_RESPONSE=t,n()})):(i.ERROR="Missing arguments",n())}))})):(this.ERROR="Not a valid address.",n())},e.contractEthLogin=function(t,e,n){var i=this;void 0===n&&(n=function(){window.location.reload()}),t.enable().then((function(r){i.walletValidation(t,e,r[0],n)}))},e.walletValidation=function(t,e,n,i){var r=this;return/^(0x)?[0-9a-f]{40}$/i.test(e)?fetch(this.CONTRACT_AUTH_ROUTE+"/"+e,{method:"get"}).then((function(t){return t.text()})).then((function(e){var a,s="";if((s=JSON.parse(e))[1].value=r.PREFIX+(a=s[1].value),!/^[a-fA-F0-9]+$/.test(a))return r.ERROR="Message error, please try again.",i();t.sendAsync({id:1,method:"eth_signTypedData",params:[s,n]},(function(t,e){if(t||e.error)return r.ERROR=t||e.error,i();var n=e.result;return null!==a&&null!==n?fetch(r.CONTRACT_AUTH_ROUTE+"/"+a+"/"+n,{method:"post"}).then((function(t){return t.text()})).then((function(t){r.AUTH_RESPONSE=t,i()})):(r.ERROR="Missing arguments",i())}))})):(this.ERROR="Not a valid address.",i())},e.getMessage=function(t){var e=this;if(!/^(0x)?[0-9a-f]{40}$/i.test(t))throw Error("Not a valid address.");return fetch(this.CONTRACT_AUTH_ROUTE+"/"+t,{method:"get"}).then((function(t){return t.text()})).then((function(t){if(!/^[a-fA-F0-9]+$/.test(t))throw Error("Something went wrong, please try again later.");return e.PREFIX+t}))},e.checkIsValid=function(t,e,n){var i=this,r=t.replace(this.PREFIX,"");return fetch(this.CONTRACT_AUTH_ROUTE+"/"+r+"/"+e,{method:"post"}).then((function(t){return t.text()})).then((function(t){i.AUTH_RESPONSE=t,n()}))},t}(),Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=eauth.umd.production.min.js.map
